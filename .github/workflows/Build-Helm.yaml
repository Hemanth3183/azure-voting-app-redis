name: Build Helm chart and push to ACR
on: 
  # push:
  #   branches:
  #     - master
  workflow_dispatch:
jobs:
  BuildHelmChart:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Helm
      uses: azure/setup-helm@v1
      with:
        version: 'v3.2.4'
    - name: Build Helm chart
      run: |
        helm package ./helm-chart
    - name: Push Helm chart to ACR
      uses: azure/acr-helm@v1
      with:
        azure_credentials: ${{ secrets.AZURE_CREDENTIALS }}
        azure_resource_group: ${{ secrets.AZURE_RESOURCE_GROUP }}
        azure_container_registry: ${{ secrets.AZURE_CONTAINER_REGISTRY }}
        helm_chart_package: ./azure-vote-0.1.0.tgz
        helm_chart_version: 0.1.0
        helm_chart_name: azure-vote